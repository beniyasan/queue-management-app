# テスト計画（回転RPC）

## 正常系
- 単発の交代
  - 交代数1〜複数で、固定は残り、queue先頭がparty末尾に入り、party先頭（固定除外）がqueue末尾へ移動
  - 不足補充で party_size まで queue からさらに補充
- 複数人同時交代の順序決定性
  - 交代数2以上で、待機の先頭から選ばれた複数人の相対順が、パーティー移動後も維持される
  - パーティーから待機に下がる複数人の相対順も維持される
- 並びの正規化
  - party / queue ともに `order_index` が 0..N-1 で連番
- 閲覧者反映
  - 管理者交代後、閲覧者画面が最新順序に更新

## 競合系
- 「次へ」連打
  - UIが2重起動を防止（ボタンdisabled）
  - もし押せたとしてもRPC側で直列化され、順序破綻や消失がない
- 別クライアント同時交代
  - 片方が完了→もう片方が待機/失敗（想定内）。最終状態は一貫

## 回帰
- DnD等の手動並び替え・固定切替との共存（交代後も整合が保たれる）
- 交代プレビューハイライトが概ね期待に沿う（RPC実行時点の実順と一致しうること）
 - `order_index` 一時重複があっても最終正規化で安定順序（`order_index, user_id`）となる

## ロールバック
- フロントを旧実装へ戻しても、関数やインデックスは害なし（残置可）
